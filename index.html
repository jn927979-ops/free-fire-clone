<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Mobile Free Fire Clone</title>
    <style>
        body { margin: 0; overflow: hidden; touch-action: none; font-family: sans-serif; }
        #crosshair {
            position: absolute; top: 50%; left: 50%; width: 10px; height: 10px;
            background: red; border-radius: 50%; transform: translate(-50%, -50%);
            pointer-events: none; z-index: 10;
        }
        /* Mobile Controls Styling */
        .controls {
            position: absolute; bottom: 20px; left: 20px;
            display: grid; grid-template-columns: repeat(3, 50px); grid-gap: 5px;
            z-index: 20;
        }
        .btn {
            width: 50px; height: 50px; background: rgba(255,255,255,0.5);
            border-radius: 10px; display: flex; align-items: center; justify-content: center;
            user-select: none; font-weight: bold; font-size: 20px;
        }
        #shoot-btn {
            position: absolute; bottom: 40px; right: 40px;
            width: 70px; height: 70px; background: rgba(255, 0, 0, 0.6);
            border-radius: 50%; display: flex; align-items: center; justify-content: center;
            color: white; font-weight: bold; z-index: 20;
        }
    </style>
</head>
<body>

    <div id="crosshair"></div>
    
    <div class="controls">
        <div></div><div class="btn" id="btn-up">↑</div><div></div>
        <div class="btn" id="btn-left">←</div><div class="btn" id="btn-down">↓</div><div class="btn" id="btn-right">→</div>
    </div>

    <div id="shoot-btn">FIRE</div>

    <script type="module">
        import * as THREE from 'https://cdn.skypack.dev/three@0.132.2';

        // 1. Scene Setup
        const scene = new THREE.Scene();
        scene.background = new THREE.Color(0x87ceeb);
        const camera = new THREE.PerspectiveCamera(75, window.innerWidth / window.innerHeight, 0.1, 1000);
        const renderer = new THREE.WebGLRenderer({ antialias: true });
        renderer.setSize(window.innerWidth, window.innerHeight);
        document.body.appendChild(renderer.domElement);

        // 2. Lighting & Ground
        const light = new THREE.AmbientLight(0xffffff, 0.8);
        scene.add(light);
        const ground = new THREE.Mesh(
            new THREE.PlaneGeometry(200, 200),
            new THREE.MeshPhongMaterial({ color: 0x228B22 })
        );
        ground.rotation.x = -Math.PI / 2;
        scene.add(ground);

        // Add some "Enemies" (Red Boxes)
        for(let i=0; i<10; i++) {
            const enemy = new THREE.Mesh(new THREE.BoxGeometry(2, 4, 2), new THREE.MeshPhongMaterial({color: 0xff0000}));
            enemy.position.set(Math.random()*40-20, 2, Math.random()*40-20);
            scene.add(enemy);
        }

        // 3. Movement & Rotation Logic
        let moveForward = false, moveBackward = false, moveLeft = false, moveRight = false;
        let yaw = 0, pitch = 0;

        // Touch Look (Ghumne ke liye)
        let touchStartX = 0, touchStartY = 0;
        window.addEventListener('touchstart', (e) => {
            touchStartX = e.touches[0].clientX;
            touchStartY = e.touches[0].clientY;
        });
        window.addEventListener('touchmove', (e) => {
            const deltaX = e.touches[0].clientX - touchStartX;
            const deltaY = e.touches[0].clientY - touchStartY;
            touchStartX = e.touches[0].clientX;
            touchStartY = e.touches[0].clientY;

            yaw -= deltaX * 0.005;
            pitch -= deltaY * 0.005;
            pitch = Math.max(-Math.PI/2, Math.min(Math.PI/2, pitch));
        });

        // Button Events
        const setupBtn = (id, action) => {
            const el = document.getElementById(id);
            el.addEventListener('touchstart', () => action(true));
            el.addEventListener('touchend', () => action(false));
        };

        setupBtn('btn-up', (val) => moveForward = val);
        setupBtn('btn-down', (val) => moveBackward = val);
        setupBtn('btn-left', (val) => moveLeft = val);
        setupBtn('btn-right', (val) => moveRight = val);

        // 4. Shooting Function
        document.getElementById('shoot-btn').addEventListener('touchstart', () => {
            const bullet = new THREE.Mesh(new THREE.SphereGeometry(0.2), new THREE.MeshBasicMaterial({color: 0xffff00}));
            bullet.position.copy(camera.position);
            const dir = new THREE.Vector3(0, 0, -1).applyQuaternion(camera.quaternion);
            scene.add(bullet);

            let lifetime = 0;
            const bInterval = setInterval(() => {
                bullet.position.addScaledVector(dir, 1);
                lifetime++;
                if(lifetime > 50) { scene.remove(bullet); clearInterval(bInterval); }
            }, 20);
        });

        // 5. Game Loop
        camera.position.y = 2;
        function animate() {
            requestAnimationFrame(animate);

            camera.quaternion.setFromEuler(new THREE.Euler(pitch, yaw, 0, 'YXZ'));

            const speed = 0.2;
            const dir = new THREE.Vector3();
            camera.getWorldDirection(dir);
            dir.y = 0; dir.normalize();
            const side = new THREE.Vector3().crossVectors(new THREE.Vector3(0,1,0), dir).normalize();

            if (moveForward) camera.position.addScaledVector(dir, speed);
            if (moveBackward) camera.position.addScaledVector(dir, -speed);
            if (moveLeft) camera.position.addScaledVector(side, speed);
            if (moveRight) camera.position.addScaledVector(side, -speed);

            renderer.render(scene, camera);
        }
        animate();
    </script>
</body>
</html>
