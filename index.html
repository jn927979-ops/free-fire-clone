<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>FF Mobile Web Clone</title>
    <style>
        body { margin: 0; overflow: hidden; touch-action: none; font-family: 'Arial', sans-serif; background: #000; }
        canvas { display: block; }

        /* UI Elements */
        #ui-layer { position: absolute; top: 0; left: 0; width: 100%; height: 100%; pointer-events: none; }
        .hud { pointer-events: auto; }

        /* Health Bar */
        #health-container { position: absolute; bottom: 30px; left: 50%; transform: translateX(-50%); width: 200px; height: 15px; background: rgba(0,0,0,0.5); border: 2px solid #fff; }
        #health-bar { width: 100%; height: 100%; background: #ff3333; transition: width 0.3s; }

        /* Kill Counter */
        #kill-info { position: absolute; top: 20px; right: 20px; color: #fff; font-weight: bold; font-size: 20px; text-shadow: 2px 2px #000; }

        /* Joystick & Buttons */
        #joystick-zone { position: absolute; bottom: 40px; left: 40px; width: 120px; height: 120px; background: rgba(255,255,255,0.1); border-radius: 50%; }
        #joystick-stick { position: absolute; top: 35px; left: 35px; width: 50px; height: 50px; background: rgba(255,255,255,0.5); border-radius: 50%; }
        
        #fire-btn { position: absolute; bottom: 60px; right: 40px; width: 80px; height: 80px; background: rgba(255,50,50,0.7); border-radius: 50%; display: flex; align-items: center; justify-content: center; color: white; font-weight: bold; border: 4px solid #fff; }

        /* Crosshair */
        #crosshair { position: absolute; top: 50%; left: 50%; width: 14px; height: 14px; border: 2px solid rgba(255,255,255,0.8); border-radius: 50%; transform: translate(-50%, -50%); }

        /* Game Over Screen */
        #game-over { position: absolute; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.8); display: none; flex-direction: column; align-items: center; justify-content: center; color: white; z-index: 100; }
        #restart-btn { margin-top: 20px; padding: 15px 30px; background: #ff3333; border: none; color: white; font-size: 20px; border-radius: 10px; cursor: pointer; }
    </style>
</head>
<body>

    <div id="ui-layer">
        <div id="kill-info">KILLS: <span id="kill-count">0</span></div>
        <div id="health-container"><div id="health-bar"></div></div>
        <div id="crosshair"></div>
        
        <div id="joystick-zone" class="hud">
            <div id="joystick-stick"></div>
        </div>
        <div id="fire-btn" class="hud">FIRE</div>
    </div>

    <div id="game-over">
        <h1>BOOYAH FAIL!</h1>
        <p>You were eliminated.</p>
        <button id="restart-btn" onclick="location.reload()">RESTART</button>
    </div>

    <script type="module">
        import * as THREE from 'https://cdn.skypack.dev/three@0.132.2';

        // --- SETUP ---
        const scene = new THREE.Scene();
        scene.background = new THREE.Color(0xa0d2eb);
        scene.fog = new THREE.Fog(0xa0d2eb, 10, 100);

        const camera = new THREE.PerspectiveCamera(75, window.innerWidth/window.innerHeight, 0.1, 1000);
        const renderer = new THREE.WebGLRenderer({ antialias: false }); // Fast Performance
        renderer.setPixelRatio(window.devicePixelRatio > 1 ? 1.5 : 1); // FPS Boost
        renderer.setSize(window.innerWidth, window.innerHeight);
        document.body.appendChild(renderer.domElement);

        const light = new THREE.HemisphereLight(0xffffff, 0x444444, 1);
        scene.add(light);

        // --- GROUND ---
        const ground = new THREE.Mesh(
            new THREE.PlaneGeometry(200, 200),
            new THREE.MeshPhongMaterial({ color: 0x4e7a32 })
        );
        ground.rotation.x = -Math.PI / 2;
        scene.add(ground);

        // --- PLAYER STATE ---
        let health = 100;
        let kills = 0;
        let isDead = false;
        let moveX = 0, moveZ = 0;
        let lookYaw = 0, lookPitch = 0;

        // --- ENEMIES SYSTEM ---
        const enemies = [];
        const enemySpeed = 0.05;

        function spawnEnemy() {
            const geo = new THREE.BoxGeometry(1.5, 3, 1.5);
            const mat = new THREE.MeshLambertMaterial({ color: 0xff0000 });
            const enemy = new THREE.Mesh(geo, mat);
            
            // Random position away from player
            const angle = Math.random() * Math.PI * 2;
            const dist = 30 + Math.random() * 20;
            enemy.position.set(Math.cos(angle)*dist, 1.5, Math.sin(angle)*dist);
            
            scene.add(enemy);
            enemies.push(enemy);
        }

        for(let i=0; i<8; i++) spawnEnemy();

        // --- BULLETS ---
        const bullets = [];
        function shoot() {
            if(isDead) return;
            const b = new THREE.Mesh(new THREE.SphereGeometry(0.2), new THREE.MeshBasicMaterial({color: 0xffff00}));
            b.position.copy(camera.position);
            const dir = new THREE.Vector3(0,0,-1).applyQuaternion(camera.quaternion);
            bullets.push({ mesh: b, dir: dir, life: 60 });
            scene.add(b);
        }

        // --- CONTROLS (TOUCH & JOYSTICK) ---
        const joystick = document.getElementById('joystick-stick');
        const stickRect = document.getElementById('joystick-zone').getBoundingClientRect();
        const centerX = stickRect.left + 60, centerY = stickRect.top + 60;

        window.addEventListener('touchmove', (e) => {
            for(let t of e.touches) {
                // Joystick logic
                if(t.clientX < window.innerWidth / 2) {
                    let dx = t.clientX - centerX;
                    let dy = t.clientY - centerY;
                    let dist = Math.sqrt(dx*dx + dy*dy);
                    let max = 40;
                    if(dist > max) { dx *= max/dist; dy *= max/dist; }
                    joystick.style.transform = `translate(${dx}px, ${dy}px)`;
                    moveX = dx/max; moveZ = dy/max;
                } 
                // Look logic (Right side of screen)
                else {
                    lookYaw -= t.force ? 0 : (e.movementX || 0) * 0.005; 
                    // Note: Basic touch look without movementX needs delta calc
                }
            }
        });

        // Simple Mobile Look Support
        let lastTouchX = 0, lastTouchY = 0;
        window.addEventListener('touchstart', e => {
            lastTouchX = e.touches[0].clientX;
            lastTouchY = e.touches[0].clientY;
        });
        window.addEventListener('touchmove', e => {
            let t = e.touches[0];
            if(t.clientX > window.innerWidth / 2) {
                let dx = t.clientX - lastTouchX;
                let dy = t.clientY - lastTouchY;
                lookYaw -= dx * 0.005;
                lookPitch -= dy * 0.005;
                lookPitch = Math.max(-1.5, Math.min(1.5, lookPitch));
            }
            lastTouchX = t.clientX; lastTouchY = t.clientY;
        });

        window.addEventListener('touchend', () => {
            joystick.style.transform = `translate(0,0)`;
            moveX = 0; moveZ = 0;
        });

        document.getElementById('fire-btn').addEventListener('touchstart', (e) => {
            e.preventDefault(); shoot();
        });

        // --- GAME LOOP ---
        function update() {
            if(isDead) return;

            // 1. Player Move
            const dir = new THREE.Vector3(moveX, 0, moveZ).applyEuler(new THREE.Euler(0, lookYaw, 0));
            camera.position.x += dir.x * 0.15;
            camera.position.z += dir.z * 0.15;
            camera.rotation.set(lookPitch, lookYaw, 0, 'YXZ');
            camera.position.y = 2;

            // 2. Enemies AI
            enemies.forEach((en, index) => {
                const dist = en.position.distanceTo(camera.position);
                
                // Follow player
                const vec = new THREE.Vector3().subVectors(camera.position, en.position).normalize();
                en.position.x += vec.x * enemySpeed;
                en.position.z += vec.z * enemySpeed;

                // Attack player
                if(dist < 2) {
                    health -= 0.5;
                    document.getElementById('health-bar').style.width = health + "%";
                    if(health <= 0) {
                        isDead = true;
                        document.getElementById('game-over').style.display = 'flex';
                    }
                }
            });

            // 3. Bullets & Collision
            bullets.forEach((b, bi) => {
                b.mesh.position.addScaledVector(b.dir, 1);
                b.life--;
                
                // Hit enemy?
                enemies.forEach((en, ei) => {
                    if(b.mesh.position.distanceTo(en.position) < 2) {
                        scene.remove(en);
                        enemies.splice(ei, 1);
                        scene.remove(b.mesh);
                        bullets.splice(bi, 1);
                        kills++;
                        document.getElementById('kill-count').innerText = kills;
                        spawnEnemy(); // Keep action going
                    }
                });

                if(b.life <= 0) {
                    scene.remove(b.mesh);
                    bullets.splice(bi, 1);
                }
            });

            renderer.render(scene, camera);
            requestAnimationFrame(update);
        }

        update();

        // Handle Resize
        window.addEventListener('resize', () => {
            camera.aspect = window.innerWidth / window.innerHeight;
            camera.updateProjectionMatrix();
            renderer.setSize(window.innerWidth, window.innerHeight);
        });

    </script>
</body>
</html>
